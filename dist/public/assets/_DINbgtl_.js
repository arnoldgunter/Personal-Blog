var Ve=[],Le=Symbol();function $t(i){return i[Symbol.iterator]=Qe,i[Le]=Ve,i}function*Qe(){yield this,yield*this[Le]}function we(i,e){if(i){let t=0;for(let n of i)e(n,t++)}}function Ce(i){if(i){if(typeof i=="string")return i;let e=i.content||i.default||i;if("e"in e)return e}}var R=i=>(i+(i<26?10:i<962?334:11998)).toString(36);function Ye(i){return i?Array.isArray(i)?i:[i]:[]}function Xe(i,e){return i?Array.isArray(i)?(i.push(e),i):[i,e]:e}var Ze=et();function Wt(i,e,t){i["$"+e]===void 0&&Ze(i,e,tt),i["$"+e]=t||null}function et(){let i=Symbol();return function(e,t,n){((e=e.getRootNode())[i]||={})[t]||=(e.addEventListener(t,n,!0),1)}}function tt(i){let e=!B&&i.target;for(;e;)e["$"+i.type]?.(i,e),e=i.bubbles&&!i.cancelBubble&&e.parentNode}var je=1e6;function qe(i,e){let t={L:je++,H:1,F:e,$:i};return re.push(t),t}function Oe(){return je++}function Ne(i,e){let t=i.F;for(;t&&!t[e];)t=t.N;return t}function le(i){i.N?.D?.delete(i),Ue(i)}function Ue(i){i.I=1,i.D?.forEach(Ue),i.B?.forEach(e=>{for(let t in e.A)vt(e,t)})}function $(i){le(i),pt(i.S,i.K)}function L(i,e,t){ue(e,t,i.S,i.K)}function ve(i){let e=new DocumentFragment;e.namespaceURI=i.S.parentNode.namespaceURI,ue(e,null,i.S,i.K)}var U=document.createTreeWalker(document);function ee(i,e,t){U.currentNode=i,_e(0,e,t)}function _e(i,e,t){let n,s,r=0,o=0,a=0;for(;i<e.length;)if(n=e.charCodeAt(i++),o=r,r=0,n===32){let c=U.currentNode;t[s=R(a++)]=c,t["J"+s]=()=>c}else if(n===37||n===49)U.currentNode.replaceWith(U.currentNode=t[R(a++)]=new Text),n===49&&(t[R(a++)]=Oe());else{if(n===38)return i;if(n===47||n===48)i=_e(i,e,t[R(a++)]=qe(t.$,t.F)),n===48&&(t[R(a++)]=Oe());else if(n<92)for(n=20*o+n-67;n--;)U.nextNode();else if(n<107)for(n=10*o+n-97;n--;)U.nextSibling();else if(n<117){for(n=10*o+n-107;n--;)U.parentNode();U.nextSibling()}else r=o*10+n-117}}var te={},V;function Q(){V=1}function Ht(i="M"){let e=self[i],t=r=>Object.defineProperty(self,i,r),n,s=r=>{t({value:n=(o=>{let a=n[o]=r[o]||r(o),c=a.w,u=a.s={},S={_:te},b=V&&(()=>{let w,v=[],ge=[],H=[],be=(M,me)=>{let X=h.parentNode,P=h,ye=H.length,J,A,Se,x;for(;J=+T;){if((x||=[]).push(A=u[J]||={L:J}),A.F=A,me){for(;P.previousSibling&&~f.indexOf(P=P.previousSibling););A.K=A.S=P,p==="'"&&(A.a=P)}else w=Xe(w,A),M&&(I[M]=w,w=v.pop()),P=ge.pop(),X!==P.parentNode&&X.prepend(P),A.S=P,A.K=h.previousSibling===P?P:X.insertBefore(new Text,h);for(;ye&&H[--ye].L>J;)(Se=H.pop()).N=A,(A.D||=new Set).add(Se);E()}x&&(H.push(...x),me&&(I[M]=x.length>1?x.reverse():x[0]))};return()=>{p==="["?(T?be():(v.push(w),w=void 0),ge.push(h)):(I["J"+E()]=(M=>()=>M)(I[T]=p===")"||p==="}"?h.parentNode:h),be("A"+T,(E(),p!=="]"&&p!==")")))}})(),l,d=0,g,f,C,h,O,p,I,T,m,E=()=>T=O.slice(m,(m=O.indexOf(" ",m)+1)?m-1:O.length);return a.w=()=>{try{c(),Te=1;for(let w of C=a.r||[])if(typeof w=="string")g=w;else if(typeof w=="number")Y(u[w]||={L:w},te[g]);else for(let v of w(S))l?typeof v=="number"?d+=v:(u[v.L=++d]=v,v.$=l,V&&(v.F=u[v.G])):(l=v||{},l.runtimeId=i,l.renderId=o);for(h of f=a.v)m=a.i.length,O=h.data,p=O[m++],I=u[+E()]||={L:+T},p==="*"?I["J"+E()]=(w=>()=>w)(I[T]=h.previousSibling):V&&b();de()}finally{Te=f.length=C.length=0}},a})})};if(e){s(e);for(let r in e)n(r).w()}else t({configurable:!0,set:s})}var Te;function xe(i,e){return te[i]=e}var nt={};function it(i,e){let t=nt[e]||=document.createElementNS(e,"template");return t.innerHTML=i,t.content||t}var ne,G;function ie(){ne||(ne=1,queueMicrotask(st))}function st(){de(),requestAnimationFrame(rt)}function rt(){G||(G=new MessageChannel,G.port1.onmessage=()=>{ne=0,de()}),G.port2.postMessage(0)}function Jt(i,e){let t=R(i),n="M"+t;return(s,r,o)=>(B?((s[n]=o)&&s[t]!==r||s.H)&&(s[t]=r,e?.(s)):s[n]?s[n](r):s[t]!==(s[t]=r)&&e&&(ie(),_(s,e,i)),r)}function Gt(i,e){return i=R(i),(t,n)=>{(!(i in t)||t[i]!==n)&&(t[i]=n,e?.(t))}}function zt(i,e,t=1,n="L"){return s=>{s.H?i in s?--s[i]||e(s):s[i]=t:_(s,e,i,0,s[n])}}function Vt(i,e,t){i=R(i);let n="A"+i,s="D"+i,r=o=>{let a=o[n];a&&!a.H&&(o[s]||0)===e&&_(a,t,-1)};return r._=t,r}function ot(i,e,t){let n=i[e]||=new Set;n.has(t)||(n.add(t),Me(t,-1).addEventListener("abort",()=>i[e].delete(t)))}function Qt(...i){let[{j:e,k:t}]=i;for(let n=i.length;n--;)i[n].n=n;return n=>{if(n[e])for(let s of n[e])s.H||_(s,i[s[t]],-1)}}function Yt(i,e,t){i=R(i);let n=(s=>{s[n.k]=n.n,e(s),ot(t?t(s):s._,n.j,s)});return n.j="B"+i,n.k="C"+i,n}function Xt(i,e){return xe(i,e),t=>{Y(t,e)}}function at(i,e,t,n){let s=qe(i),r=t?.F;return s._=e.c||t,s.F=s,r&&(s.N=r,(r.D||=new Set).add(s)),e.f?.(s,n.namespaceURI),s}function K(i,e,t,n){return ct(e,at(i,e,t,n))}function ct(i,e){return i.g&&_(e,i.g,-1),e}function De(i,e,t,n,s,r){t=t?t.replace(/[^\0-1]+$/,""):"",n=n?n._||n:void 0,s||=void 0;let o=e?(a,c)=>{((lt[c]||={})[e]||=ut(e,c))(a,t)}:a=>{ee(a.S=a.K=new Text,t,a)};return a=>({e:i,f:o,c:a,g:n,a:s,b:r})}function Zt(i,e,t,n,s,r){return xe(i,De(i,e,t,n,s,r))}function en(i,e,t,n){return De("",i,e,t,n)()}var lt={};function ut(i,e){let{firstChild:t,lastChild:n}=it(i,e),s=document.createElementNS(e,"t");return ue(s,null,t,n),t===n&&t.nodeType<8?(r,o)=>{ee(r.S=r.K=t.cloneNode(!0),o,r)}:(r,o)=>{let a=s.cloneNode(!0);ee(a.firstChild,o,r),r.S=a.firstChild,r.K=a.lastChild}}function tn(i,e,t){ht(i,e,dt(t))}function ht(i,e,t){i.getAttribute(e)!=t&&(t===void 0?i.removeAttribute(e):i.setAttribute(e,t))}function nn(i,e){let t=ft(e);i.data!==t&&(i.data=t)}function dt(i){if(i||i===0)return i===!0?"":i+""}function ft(i){return i||i===0?i+"":"â€"}function sn(i,e,t){let n=i[e];n?(Object.assign(n,t),n.onUpdate?.()):(i[e]=t,t.onMount?.(),Me(i,"K"+e).onabort=()=>t.onDestroy?.())}function pt(i,e){let t=e.nextSibling,n=i;for(;n!==t;){let s=n.nextSibling;n.remove(),n=s}}function ue(i,e,t,n){i.insertBefore(gt(t,n),e)}function gt(i,e){if(i===e)return i;let t=new DocumentFragment,n=e.nextSibling,s=i;for(;s!==n;){let r=s.nextSibling;t.appendChild(s),s=r}return t}var Re=2147483647;function bt(i,e,t,n){let s=0,r=0,o=e.length-1,a=t.length-1,c=e[s],u=t[r],S=e[o],b=t[a],l,d,g,f,C,h;e:{for(;c===u;){if(++s,++r,s>o||r>a)break e;c=e[s],u=t[r]}for(;S===b;){if(--o,--a,s>o||r>a)break e;S=e[o],b=t[a]}}if(s>o){if(r<=a){g=a+1,f=g<t.length?t[g].S:n;do L(t[r++],i,f);while(r<=a)}}else if(r>a)do $(e[s++]);while(s<=o);else{let O=o-s+1,p=a-r+1,I=e,T=new Array(p);for(l=0;l<p;++l)T[l]=-1;let m=0,E=0,w=new Map;for(d=r;d<=a;++d)w.set(t[d],d);for(l=s;l<=o&&E<p;++l)C=e[l],d=w.get(C),d!==void 0&&(m=m>d?Re:d,++E,h=t[d],T[d-r]=l,I[l]=null);if(O===e.length&&E===0){for(;r<p;++r)L(t[r],i,n);for(;s<O;++s)$(e[s])}else{for(l=O-E;l>0;)C=I[s++],C!==null&&($(C),l--);if(m===Re){let v=mt(T);for(d=v.length-1,g=t.length,l=p-1;l>=0;--l)T[l]===-1||d<0||l!==v[d]?(m=l+r,h=t[m++],f=m<g?t[m].S:n,L(h,i,f)):--d}else if(E!==p)for(g=t.length,l=p-1;l>=0;--l)T[l]===-1&&(m=l+r,h=t[m++],f=m<g?t[m].S:n,L(h,i,f))}}}function mt(i){let e=i.slice(),t=[0],n,s;for(let r=0,o=i.length;r<o;++r){if(i[r]===-1)continue;let a=t[t.length-1];if(i[a]<i[r]){e[r]=a,t.push(r);continue}for(n=0,s=t.length-1;n<s;){let c=(n+s)/2|0;i[t[c]]<i[r]?n=c+1:s=c}i[r]<i[t[n]]&&(n>0&&(e[r]=t[n-1]),t[n]=r)}for(n=t.length,s=t[n-1];n-- >0;)t[n]=s,s=e[s];return t}function rn(i,e){i=R(i);let t="L"+i,n="A"+i;return Q(),(s,r)=>{let o=s[i],a=Ne(s,"Q"),c=s[n];a?(se.add(j),!s[t]&&(a.O=(a.O||0)+1)===1&&requestAnimationFrame(()=>a.O&&W(Ct(()=>_(a,()=>{L(a.P=K(s.$,a.Q,a._,a.S.parentNode),a.S.parentNode,a.S),ve(a)},-1))))):c&&!s[t]&&(c.S.parentNode.insertBefore(o,c.S),ve(c));let u=s[t]=r.then(S=>{u===s[t]&&(s[t]=0,ie(),_(s,()=>{if(c?a||o.replaceWith(c.S.parentNode):(L(c=s[n]=K(s.$,e,s,o.parentNode),o.parentNode,o),o.remove()),e.a?.(c,[S]),a&&(se.add(j),!--a.O)){let b=a.P;a.P=0,b&&(b.S.parentNode.insertBefore(a.S.parentNode,b.S),$(b)),Y(a,l=>{let d=l.J;d&&(l.J=[],W(d,!0))})}},-1))},S=>{u===s[t]&&(a&&(a.O=0),s[t]=0,ie(),_(s,Fe,-1,S))})}}function on(i,e){i=R(i);let t="A"+i;return(n,s)=>{n[t]||he(n,i,e,K);let r=n[t];r&&(r.C=i,r.E=Ce(s.catch),r.Q=Ce(s.placeholder))}}function Fe(i,e){let t=Ne(i,"E");if(t){let n=t._,s=t.P;s&&(t.O=0,n["A"+t.C]=s,le(t)),Ke.add(j),he(n,t.C,t.E,K),t.E.a?.(n["A"+t.C],[e])}else throw e}function an(i,...e){i=R(i);let t="D"+i;return Q(),(n,s)=>{s!==n[t]&&he(n,i,e[n[t]=s],K)}}function he(i,e,t,n){let s=i[e],r=i["A"+e],o=s.nodeType>1?(r?.S||s).parentNode:s,a=i["A"+e]=t&&n(i.$,t,i,o);s===o?(r&&(le(r),s.textContent=""),a&&L(a,o,null)):r?(a?L(a,o,r.S):o.insertBefore(s,r.S),$(r)):a&&(L(a,o,s),s.remove())}function cn(i,e){return yt(i,e,([t,n=St],s)=>{typeof n=="string"?we(t,(r,o)=>s(r[n],[r,o])):we(t,(r,o)=>s(n(r,o),[r,o]))})}function yt(i,e,t){i=R(i);let n=e.a,s="A"+i,r="A"+s;return Q(),(o,a)=>{let c=o[i],u=Ye(o[s]),S=o[r]||u.reduce((f,C,h)=>f.set(C.M??h,C),new Map),b=o[s]=[],l=o[r]=new Map,d=c.nodeType>1?c.parentNode||u[0]?.S.parentNode:c;t(a,(f,C)=>{let h=S.get(f)||K(o.$,e,o,d);n?.(h,C),l.set(f,h),b.push(h)});let g=null;c!==d&&(u.length?(g=u[u.length-1].K.nextSibling,b.length||d.insertBefore(c,g)):b.length&&(g=c.nextSibling,c.remove())),bt(d,u,b,g)}}function St(i,e){return e}var y=[],D=new Map,Ke=new WeakSet,se=new WeakSet,j=[],re=[],B,wt=1e3;function _(i,e,t,n,s=i.L){let r=s*wt+t,o=t>=0&&D.get(r);if(o)o.m=n;else{let a={d:r,h:i,p:e,m:n},c=y.push(a)-1;for(;c;){let u=c-1>>1,S=y[u];if(r-S.d>=0)break;y[c]=S,c=u}t>=0&&D.set(r,a),y[c]=a}}function Y(i,e){j.push(e,i)}function de(){let i=j;try{B=1,Be()}finally{y=[],D=new Map,j=[],B=0}W(i)}function Ct(i){let e=y,t=D,n=j,s=j=[];y=[],D=new Map;try{B=1,i(),Be()}finally{B=0,y=e,D=t,j=n}return s}var W=(i=>{for(let e=0;e<i.length;)i[e++](i[e++])});function Be(){for(;y.length;){let i=y[0],e=y.pop();if(i!==e){let t=0,n=y.length>>1,s=(y[0]=e).d;for(;t<n;){let r=(t<<1)+1,o=r+1;if(o<y.length&&y[o].d-y[r].d<0&&(r=o),y[r].d-s>=0)break;y[t]=y[r],t=r}y[t]=e}i.h.F?.I||oe(i)}for(let i of re)i.H=0;re=[]}var oe=i=>i.p(i.h,i.m),Ot=()=>{Ot=()=>{},Q();let i=(e,t,n)=>{for(;n;){if(n.O)return(n.J||=[]).push(e,t);n=n.N}};W=(e=>(t,n=se.has(t))=>{if(n||Ke.has(t)){let s=0,r,o,a;for(;s<t.length;)r=t[s++],o=t[s++],a=o.F,!a?.I&&!(n&&i(r,o,a))&&r(o)}else e(t)})(W),oe=(e=>t=>{try{e(t)}catch(n){Fe(t.h,n)}})(oe)};function vt(i,e){let t=i.A?.[e];t&&(Y(t,Tt),i.A[e]=void 0)}function Me(i,e){return i.F&&(i.F.B||=new Set).add(i),((i.A||={})[e]||=new AbortController).signal}function Tt(i){i.abort()}class k extends Error{constructor(e){super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,k.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof k||(this.originalError=e),typeof DOMException<"u"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":this.originalError?.cause?.message?.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}const z=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function Rt(i,e){const t={};if(typeof i!="string")return t;const n=Object.assign({},{}).decode||kt;let s=0;for(;s<i.length;){const r=i.indexOf("=",s);if(r===-1)break;let o=i.indexOf(";",s);if(o===-1)o=i.length;else if(o<r){s=i.lastIndexOf(";",r-1)+1;continue}const a=i.slice(s,r).trim();if(t[a]===void 0){let c=i.slice(r+1,o).trim();c.charCodeAt(0)===34&&(c=c.slice(1,-1));try{t[a]=n(c)}catch{t[a]=c}}s=o+1}return t}function ke(i,e,t){const n=Object.assign({},t||{}),s=n.encode||It;if(!z.test(i))throw new TypeError("argument name is invalid");const r=s(e);if(r&&!z.test(r))throw new TypeError("argument val is invalid");let o=i+"="+r;if(n.maxAge!=null){const a=n.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(a)}if(n.domain){if(!z.test(n.domain))throw new TypeError("option domain is invalid");o+="; Domain="+n.domain}if(n.path){if(!z.test(n.path))throw new TypeError("option path is invalid");o+="; Path="+n.path}if(n.expires){if(!(function(c){return Object.prototype.toString.call(c)==="[object Date]"||c instanceof Date})(n.expires)||isNaN(n.expires.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():n.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}function kt(i){return i.indexOf("%")!==-1?decodeURIComponent(i):i}function It(i){return encodeURIComponent(i)}const Et=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let $e;function F(i){if(i)try{const e=decodeURIComponent($e(i.split(".")[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(e)||{}}catch{}return{}}function We(i,e=0){let t=F(i);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}$e=typeof atob!="function"||Et?i=>{let e=String(i).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,s=0,r=0,o="";n=e.charAt(r++);~n&&(t=s%4?64*t+n:n,s++%4)?o+=String.fromCharCode(255&t>>(-2*s&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o}:atob;const Ie="pb_auth";class fe{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!We(this.token)}get isSuperuser(){let e=F(this.token);return e.type=="auth"&&(this.record?.collectionName=="_superusers"||!this.record?.collectionName&&e.collectionId=="pbc_3142635823")}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),F(this.token).type=="auth"&&!this.isSuperuser}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Ie){const n=Rt(e||"")[t]||"";let s={};try{s=JSON.parse(n),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch{}this.save(s.token||"",s.record||s.model||null)}exportToCookie(e,t=Ie){const n={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=F(this.token);n.expires=s?.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},n,e);const r={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null};let o=ke(t,JSON.stringify(r),e);const a=typeof Blob<"u"?new Blob([o]).size:o.length;if(r.record&&a>4096){r.record={id:r.record?.id,email:r.record?.email};const c=["collectionId","collectionName","verified"];for(const u in this.record)c.includes(u)&&(r.record[u]=this.record[u]);o=ke(t,JSON.stringify(r),e)}return o}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.record),()=>{for(let n=this._onChangeCallbacks.length-1;n>=0;n--)if(this._onChangeCallbacks[n]==e)return delete this._onChangeCallbacks[n],void this._onChangeCallbacks.splice(n,1)}}triggerChange(){for(const e of this._onChangeCallbacks)e&&e(this.token,this.record)}}class Pt extends fe{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){const e=this._storageGet(this.storageKey)||{};return e.record||e.model||null}get model(){return this.record}save(e,t){this._storageSet(this.storageKey,{token:e,record:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window<"u"&&window?.localStorage){const t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch{return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window<"u"&&window?.localStorage){let n=t;typeof t!="string"&&(n=JSON.stringify(t)),window.localStorage.setItem(e,n)}else this.storageFallback[e]=t}_storageRemove(e){typeof window<"u"&&window?.localStorage&&window.localStorage?.removeItem(e),delete this.storageFallback[e]}_bindStorageEvent(){typeof window<"u"&&window?.localStorage&&window.addEventListener&&window.addEventListener("storage",(e=>{if(e.key!=this.storageKey)return;const t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.record||t.model||null)}))}}class q{constructor(e){this.client=e}}class At extends q{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then((()=>!0))}async testEmail(e,t,n,s){return s=Object.assign({method:"POST",body:{email:t,template:n,collection:e}},s),this.client.send("/api/settings/test/email",s).then((()=>!0))}async generateAppleClientSecret(e,t,n,s,r,o){return o=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:n,privateKey:s,duration:r}},o),this.client.send("/api/settings/apple/generate-client-secret",o)}}const Lt=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function pe(i){if(i){i.query=i.query||{};for(let e in i)Lt.includes(e)||(i.query[e]=i[e],delete i[e])}}function He(i){const e=[];for(const t in i){const n=encodeURIComponent(t),s=Array.isArray(i[t])?i[t]:[i[t]];for(let r of s)r=jt(r),r!==null&&e.push(n+"="+r)}return e.join("&")}function jt(i){return i==null?null:i instanceof Date?encodeURIComponent(i.toISOString().replace("T"," ")):encodeURIComponent(typeof i=="object"?JSON.stringify(i):i)}class Je extends q{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,n){if(!e)throw new Error("topic must be set.");let s=e;if(n){pe(n=Object.assign({},n));const o="options="+encodeURIComponent(JSON.stringify({query:n.query,headers:n.headers}));s+=(s.includes("?")?"&":"?")+o}const r=function(o){const a=o;let c;try{c=JSON.parse(a?.data)}catch{}t(c||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(r),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():this.eventSource?.addEventListener(s,r):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,r)}async unsubscribe(e){let t=!1;if(e){const n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let r of this.subscriptions[s])this.eventSource?.removeEventListener(s,r);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])this.eventSource?.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){let n=!1;const s=this.getSubscriptionsByTopic(e);for(let r in s){if(!Array.isArray(this.subscriptions[r])||!this.subscriptions[r].length)continue;let o=!1;for(let a=this.subscriptions[r].length-1;a>=0;a--)this.subscriptions[r][a]===t&&(o=!0,delete this.subscriptions[r][a],this.subscriptions[r].splice(a,1),this.eventSource?.removeEventListener(r,t));o&&(this.subscriptions[r].length||delete this.subscriptions[r],n||this.hasSubscriptionListeners(r)||(n=!0))}this.hasSubscriptionListeners()?n&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){if(this.subscriptions=this.subscriptions||{},e)return!!this.subscriptions[e]?.length;for(let t in this.subscriptions)if(this.subscriptions[t]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch((e=>{if(!e?.isAbort)throw e}))}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){const t={};e=e.includes("?")?e:e+"?";for(let n in this.subscriptions)(n+"?").startsWith(e)&&(t[n]=this.subscriptions[n]);return t}getNonEmptySubscriptionKeys(){const e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise(((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()}))}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout((()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))}),this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",(e=>{const t=e;this.clientId=t?.lastEventId,this.submitSubscriptions().then((async()=>{let n=3;for(;this.hasUnsentSubscriptions()&&n>0;)n--,await this.submitSubscriptions()})).then((()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const n=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in n)for(let r of n[s])r(e)})).catch((n=>{this.clientId="",this.connectErrorHandler(n)}))}))}hasUnsentSubscriptions(){const e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(const t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let n of this.pendingConnects)n.reject(new k(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout((()=>{this.initConnect()}),t)}disconnect(e=!1){if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let t of this.pendingConnects)t.resolve();this.pendingConnects=[]}}}class Ge extends q{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let n=500;return(t=Object.assign({},e,t)).batch&&(n=t.batch,delete t.batch),this._getFullList(n,t)}async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send(this.baseCrudPath,n).then((s=>(s.items=s.items?.map((r=>this.decode(r)))||[],s)))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then((n=>{if(!n?.items?.length)throw new k({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return n.items[0]}))}async getOne(e,t){if(!e)throw new k({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((n=>this.decode(n)))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then((n=>this.decode(n)))}async update(e,t,n){return n=Object.assign({method:"PATCH",body:t},n),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),n).then((s=>this.decode(s)))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((()=>!0))}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let n=[],s=async r=>this.getList(r,e||500,t).then((o=>{const a=o.items;return n=n.concat(a),a.length==o.perPage?s(r+1):n}));return s(1)}}function N(i,e,t,n){const s=n!==void 0;return s||t!==void 0?s?(console.warn(i),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,n),e):Object.assign(e,t):e}function Z(i){i._resetAutoRefresh?.()}class qt extends Ge{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName=="_superusers"||this.collectionIdOrName=="_pbc_2773867675"}async subscribe(e,t,n){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,n)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);const n=Object.assign({},e,t);return super.getFullList(n)}async getList(e=1,t=30,n){return super.getList(e,t,n)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,n){return super.update(e,t,n).then((s=>{if(this.client.authStore.record?.id===s?.id&&(this.client.authStore.record?.collectionId===this.collectionIdOrName||this.client.authStore.record?.collectionName===this.collectionIdOrName)){let r=Object.assign({},this.client.authStore.record.expand),o=Object.assign({},this.client.authStore.record,s);r&&(o.expand=Object.assign(r,s.expand)),this.client.authStore.save(this.client.authStore.token,o)}return s}))}async delete(e,t){return super.delete(e,t).then((n=>(!n||this.client.authStore.record?.id!==e||this.client.authStore.record?.collectionId!==this.collectionIdOrName&&this.client.authStore.record?.collectionName!==this.collectionIdOrName||this.client.authStore.clear(),n)))}authResponse(e){const t=this.decode(e?.record||{});return this.client.authStore.save(e?.token,t),Object.assign({},e,{token:e?.token||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e)}async authWithPassword(e,t,n){let s;n=Object.assign({method:"POST",body:{identity:e,password:t}},n),this.isSuperusers&&(s=n.autoRefreshThreshold,delete n.autoRefreshThreshold,n.autoRefresh||Z(this.client));let r=await this.client.send(this.baseCollectionPath+"/auth-with-password",n);return r=this.authResponse(r),s&&this.isSuperusers&&(function(a,c,u,S){Z(a);const b=a.beforeSend,l=a.authStore.record,d=a.authStore.onChange(((g,f)=>{(!g||f?.id!=l?.id||(f?.collectionId||l?.collectionId)&&f?.collectionId!=l?.collectionId)&&Z(a)}));a._resetAutoRefresh=function(){d(),a.beforeSend=b,delete a._resetAutoRefresh},a.beforeSend=async(g,f)=>{const C=a.authStore.token;if(f.query?.autoRefresh)return b?b(g,f):{url:g,sendOptions:f};let h=a.authStore.isValid;if(h&&We(a.authStore.token,c))try{await u()}catch{h=!1}h||await S();const O=f.headers||{};for(let p in O)if(p.toLowerCase()=="authorization"&&C==O[p]&&a.authStore.token){O[p]=a.authStore.token;break}return f.headers=O,b?b(g,f):{url:g,sendOptions:f}}})(this.client,s,(()=>this.authRefresh({autoRefresh:!0})),(()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n)))),r}async authWithOAuth2Code(e,t,n,s,r,o,a){let c={method:"POST",body:{provider:e,code:t,codeVerifier:n,redirectURL:s,createData:r}};return c=N("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",c,o,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",c).then((u=>this.authResponse(u)))}authWithOAuth2(...e){if(e.length>1||typeof e?.[0]=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code(e?.[0]||"",e?.[1]||"",e?.[2]||"",e?.[3]||"",e?.[4]||{},e?.[5]||{},e?.[6]||{});const t=e?.[0]||{};let n=null;t.urlCallback||(n=Ee(void 0));const s=new Je(this.client);function r(){n?.close(),s.unsubscribe()}const o={},a=t.requestKey;return a&&(o.requestKey=a),this.listAuthMethods(o).then((c=>{const u=c.oauth2.providers.find((l=>l.name===t.provider));if(!u)throw new k(new Error(`Missing or invalid provider "${t.provider}".`));const S=this.client.buildURL("/api/oauth2-redirect"),b=a?this.client.cancelControllers?.[a]:void 0;return b&&(b.signal.onabort=()=>{r()}),new Promise((async(l,d)=>{try{await s.subscribe("@oauth2",(async h=>{const O=s.clientId;try{if(!h.state||O!==h.state)throw new Error("State parameters don't match.");if(h.error||!h.code)throw new Error("OAuth2 redirect error or missing code: "+h.error);const p=Object.assign({},t);delete p.provider,delete p.scopes,delete p.createData,delete p.urlCallback,b?.signal?.onabort&&(b.signal.onabort=null);const I=await this.authWithOAuth2Code(u.name,h.code,u.codeVerifier,S,t.createData,p);l(I)}catch(p){d(new k(p))}r()}));const g={state:s.clientId};t.scopes?.length&&(g.scope=t.scopes.join(" "));const f=this._replaceQueryParams(u.authURL+S,g);await(t.urlCallback||function(h){n?n.location.href=h:n=Ee(h)})(f)}catch(g){r(),d(new k(g))}}))})).catch((c=>{throw r(),c}))}async authRefresh(e,t){let n={method:"POST"};return n=N("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",n,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",n).then((s=>this.authResponse(s)))}async requestPasswordReset(e,t,n){let s={method:"POST",body:{email:e}};return s=N("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then((()=>!0))}async confirmPasswordReset(e,t,n,s,r){let o={method:"POST",body:{token:e,password:t,passwordConfirm:n}};return o=N("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",o,s,r),this.client.send(this.baseCollectionPath+"/confirm-password-reset",o).then((()=>!0))}async requestVerification(e,t,n){let s={method:"POST",body:{email:e}};return s=N("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/request-verification",s).then((()=>!0))}async confirmVerification(e,t,n){let s={method:"POST",body:{token:e}};return s=N("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then((()=>{const r=F(e),o=this.client.authStore.record;return o&&!o.verified&&o.id===r.id&&o.collectionId===r.collectionId&&(o.verified=!0,this.client.authStore.save(this.client.authStore.token,o)),!0}))}async requestEmailChange(e,t,n){let s={method:"POST",body:{newEmail:e}};return s=N("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/request-email-change",s).then((()=>!0))}async confirmEmailChange(e,t,n,s){let r={method:"POST",body:{token:e,password:t}};return r=N("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",r,n,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",r).then((()=>{const o=F(e),a=this.client.authStore.record;return a&&a.id===o.id&&a.collectionId===o.collectionId&&this.client.authStore.clear(),!0}))}async listExternalAuths(e,t){return this.client.collection("_externalAuths").getFullList(Object.assign({},t,{filter:this.client.filter("recordRef = {:id}",{id:e})}))}async unlinkExternalAuth(e,t,n){const s=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:e,provider:t}));return this.client.collection("_externalAuths").delete(s.id,n).then((()=>!0))}async requestOTP(e,t){return t=Object.assign({method:"POST",body:{email:e}},t),this.client.send(this.baseCollectionPath+"/request-otp",t)}async authWithOTP(e,t,n){return n=Object.assign({method:"POST",body:{otpId:e,password:t}},n),this.client.send(this.baseCollectionPath+"/auth-with-otp",n).then((s=>this.authResponse(s)))}async impersonate(e,t,n){(n=Object.assign({method:"POST",body:{duration:t}},n)).headers=n.headers||{},n.headers.Authorization||(n.headers.Authorization=this.client.authStore.token);const s=new ze(this.client.baseURL,new fe,this.client.lang),r=await s.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(e),n);return s.authStore.save(r?.token,this.decode(r?.record||{})),s}_replaceQueryParams(e,t={}){let n=e,s="";e.indexOf("?")>=0&&(n=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));const r={},o=s.split("&");for(const a of o){if(a=="")continue;const c=a.split("=");r[decodeURIComponent(c[0].replace(/\+/g," "))]=decodeURIComponent((c[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete r[a]:r[a]=t[a]);s="";for(let a in r)r.hasOwnProperty(a)&&(s!=""&&(s+="&"),s+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(r[a].replace(/%20/g,"+")));return s!=""?n+"?"+s:n}}function Ee(i){if(typeof window>"u"||!window?.open)throw new k(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,n=window.innerWidth,s=window.innerHeight;e=e>n?n:e,t=t>s?s:t;let r=n/2-e/2,o=s/2-t/2;return window.open(i,"popup_window","width="+e+",height="+t+",top="+o+",left="+r+",resizable,menubar=no")}class Nt extends Ge{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,n){return n=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},n),this.client.send(this.baseCrudPath+"/import",n).then((()=>!0))}async getScaffolds(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCrudPath+"/meta/scaffolds",e)}async truncate(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/truncate",t).then((()=>!0))}}class Ut extends q{async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send("/api/logs",n)}async getOne(e,t){if(!e)throw new k({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class _t extends q{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class xt extends q{getUrl(e,t,n={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(e,t,n)}getURL(e,t,n={}){if(!t||!e?.id||!e?.collectionId&&!e?.collectionName)return"";const s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let r=this.client.buildURL(s.join("/"));if(Object.keys(n).length){n.download===!1&&delete n.download;const o=new URLSearchParams(n);r+=(r.includes("?")?"&":"?")+o}return r}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then((t=>t?.token||""))}}class Dt extends q{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then((()=>!0))}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then((()=>!0))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then((()=>!0))}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then((()=>!0))}getDownloadUrl(e,t){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(e,t)}getDownloadURL(e,t){return this.client.buildURL(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}}class Ft extends q{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/crons",e)}async run(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/crons/${encodeURIComponent(e)}`,t).then((()=>!0))}}function ae(i){return typeof Blob<"u"&&i instanceof Blob||typeof File<"u"&&i instanceof File||i!==null&&typeof i=="object"&&i.uri&&(typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal)}function ce(i){return i&&(i.constructor?.name==="FormData"||typeof FormData<"u"&&i instanceof FormData)}function Pe(i){for(const e in i){const t=Array.isArray(i[e])?i[e]:[i[e]];for(const n of t)if(ae(n))return!0}return!1}const Kt=/^[\-\.\d]+$/;function Ae(i){if(typeof i!="string")return i;if(i=="true")return!0;if(i=="false")return!1;if((i[0]==="-"||i[0]>="0"&&i[0]<="9")&&Kt.test(i)){let e=+i;if(""+e===i)return e}return i}class Bt extends q{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(e){return this.subs[e]||(this.subs[e]=new Mt(this.requests,e)),this.subs[e]}async send(e){const t=new FormData,n=[];for(let s=0;s<this.requests.length;s++){const r=this.requests[s];if(n.push({method:r.method,url:r.url,headers:r.headers,body:r.json}),r.files)for(let o in r.files){const a=r.files[o]||[];for(let c of a)t.append("requests."+s+"."+o,c)}}return t.append("@jsonPayload",JSON.stringify({requests:n})),e=Object.assign({method:"POST",body:t},e),this.client.send("/api/batch",e)}}class Mt{constructor(e,t){this.requests=[],this.requests=e,this.collectionIdOrName=t}upsert(e,t){t=Object.assign({body:e||{}},t);const n={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(n,t),this.requests.push(n)}create(e,t){t=Object.assign({body:e||{}},t);const n={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(n,t),this.requests.push(n)}update(e,t,n){n=Object.assign({body:t||{}},n);const s={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(e)};this.prepareRequest(s,n),this.requests.push(s)}delete(e,t){t=Object.assign({},t);const n={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(e)};this.prepareRequest(n,t),this.requests.push(n)}prepareRequest(e,t){if(pe(t),e.headers=t.headers,e.json={},e.files={},t.query!==void 0){const s=He(t.query);s&&(e.url+=(e.url.includes("?")?"&":"?")+s)}let n=t.body;ce(n)&&(n=(function(r){let o={};return r.forEach(((a,c)=>{if(c==="@jsonPayload"&&typeof a=="string")try{let u=JSON.parse(a);Object.assign(o,u)}catch(u){console.warn("@jsonPayload error:",u)}else o[c]!==void 0?(Array.isArray(o[c])||(o[c]=[o[c]]),o[c].push(Ae(a))):o[c]=Ae(a)})),o})(n));for(const s in n){const r=n[s];if(ae(r))e.files[s]=e.files[s]||[],e.files[s].push(r);else if(Array.isArray(r)){const o=[],a=[];for(const c of r)ae(c)?o.push(c):a.push(c);if(o.length>0&&o.length==r.length){e.files[s]=e.files[s]||[];for(let c of o)e.files[s].push(c)}else if(e.json[s]=a,o.length>0){let c=s;s.startsWith("+")||s.endsWith("+")||(c+="+"),e.files[c]=e.files[c]||[];for(let u of o)e.files[c].push(u)}}else e.json[s]=r}}}class ze{get baseUrl(){return this.baseURL}set baseUrl(e){this.baseURL=e}constructor(e="/",t,n="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=e,this.lang=n,t?this.authStore=t:typeof window<"u"&&window.Deno?this.authStore=new fe:this.authStore=new Pt,this.collections=new Nt(this),this.files=new xt(this),this.logs=new Ut(this),this.settings=new At(this),this.realtime=new Je(this),this.health=new _t(this),this.backups=new Dt(this),this.crons=new Ft(this)}get admins(){return this.collection("_superusers")}createBatch(){return new Bt(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new qt(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let n in t){let s=t[n];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+n+"}",s)}return e}getFileUrl(e,t,n={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(e,t,n)}buildUrl(e){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(e)}buildURL(e){let t=this.baseURL;return typeof window>"u"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=window.location.origin?.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseURL.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseURL),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let n=this.buildURL(e);if(this.beforeSend){const s=Object.assign({},await this.beforeSend(n,t));s.url!==void 0||s.options!==void 0?(n=s.url||n,t=s.options||t):Object.keys(s).length&&(t=s,console?.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){const s=He(t.query);s&&(n+=(n.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(n,t).then((async s=>{let r={};try{r=await s.json()}catch{}if(this.afterSend&&(r=await this.afterSend(s,r,t)),s.status>=400)throw new k({url:s.url,status:s.status,data:r});return r})).catch((s=>{throw new k(s)}))}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=(function(s){if(typeof FormData>"u"||s===void 0||typeof s!="object"||s===null||ce(s)||!Pe(s))return s;const r=new FormData;for(const o in s){const a=s[o];if(a!==void 0)if(typeof a!="object"||Pe({data:a})){const c=Array.isArray(a)?a:[a];for(let u of c)r.append(o,u)}else{let c={};c[o]=a,r.append("@jsonPayload",JSON.stringify(c))}}return r})(t.body),pe(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||ce(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){const n=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(n);const s=new AbortController;this.cancelControllers[n]=s,t.signal=s.signal}return t}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let n in e)if(n.toLowerCase()==t)return e[n];return null}}const ln=new ze("http://127.0.0.1:8090");export{Xt as _,Wt as a,Jt as b,sn as c,an as d,en as e,Ot as f,Zt as g,Gt as h,nn as i,Qt as j,Yt as k,tn as l,zt as m,cn as n,Ht as o,ln as p,on as q,$t as r,rn as s,Vt as t};
//# sourceMappingURL=_DINbgtl_.js.map
